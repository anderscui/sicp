# 通过子程序实现抽象（Building Abstractions with Procedures）

洛克（John Locke）认为，人类心智主要以三种方式作用于简单观点：

1. 将若干简单观点**组合**；
2. 通过比较，了解两个观点之间的**关系**；
3. 提取一组观点的共同特征，此所谓**抽象**；

组合与抽象无疑是人类认识世界的重要方式，而两者在编程过程中也是无处不在的。

## 1.0 计算过程（Computational Process）

**计算过程**寓于计算机中，它自身有着演化的过程，演化之中会操作**数据**，而演化通过**程序**指定。以上三个关键词，计算过程与数据是某种抽象，程序则是某些规则的模式。

计算过程有如巫师的神灵，无有形之体，但不失真实。巫师通过咒语召唤神灵，计算过程则由编程语言来描述。

得到良好设计的计算系统，如同良好设计的汽车与核反应堆，具有模块化的设计，其组成部分可被分别构建、替换或调试。

本书使用的编程语言是Lisp（LISt Processing的缩写）。由于Lisp的实验性特点及其对符号操作的强调，初期的Lisp在数值计算方面颇为低效，至少与Fortran相比如此。之后Lisp的编译器已经得到相当程度的改进。

既然Lisp并非主流语言，为何要用它来讨论编程？因为这种语言具有的某些独特的性质，使得它成为学习程序构造与数据结构的良好媒介。其中最重要的一点是，Lisp中用于描述计算过程的结构——子程序（Procedure）——自身亦可视为数据。一些强大的程序设计技术需要这种特性，后面就会看到。

PS：本书使用的是Lisp的一种方言Scheme。

## 1.1 编程基础

编程语言不止是只是计算机完成任务，它还为我们提供了表达想法的框架。因此当我们看到一种语言时，需要特别注意其如何将简单概念组织为复杂概念。如果一种语言是强大的，它需要具备如下三种机制：

* 基本表达式（primitive expression）：用以表示语言中最简单的实体
* 组合：将较简单概念组合为复杂者
* 抽象：将复杂元素表示为具名实体和可操作的单位

编程过程中，我们处理两类元素：子程序和数据。一般而言，数据是我们要操作的实体，子程序描述操作数据的规则。

### 1.1.1 表达式

首先，我们有最基本的表达式，比如数（42）和子程序（+、-），可将子程序应用到数上：

```scheme
(+ 1 2)
```

此类表达式，即是**组合（combination）**。+是操作符（operator），后面的数字则是操作数（operand）。另外，上面的表达式采用了前缀标记法，此标记法有其优势：

* 其参数可以是任意数量的
* 组合容易表示为嵌套的

```scheme
(+ (* 3 (+ (* 2 4) (+ 3 5))) (+ (- 10 7) 6))
```

### 1.1.2 命名与环境

编程语言中，可使用**名字**引用一个**计算对象**。这时我们说，该名字标识了一个**变量**，后者的值是那个对象。如：

```scheme
;; 定义一个值
(define size 2)
```

命名之后，可以通过名字引用其指向的对象。所以解释器需要通过一块儿内存维护这些name-object对儿，这块儿内存称为**环境（environment）**。

### 1.1.3 组合求值

组合的求值遵循如下过程：

* 先对组合的各个子表达式求值
* 应用各个自表达式的值到操作符

上述过程是递归的，递归特别适合于层次化的、树形结构的数据。此过程不适用于定义，如`(define x 1)`，不是将两个参数的值应用到操作符`define`上，即`(define x 1)`不是一个组合。这类例外情况称为**特殊形式（special form）**。每一种特殊形式都具有自己特定的求值规则。

各种不同的表达式构成了一门语言的语法。Lisp的语法是极其简单的，即一个通用的组合求值规则加上少数几种特殊形式。

### 1.1.4 复合子程序



子程序在抽象中扮演了极重要的角色。[子程序（Procedure）](https://en.wikipedia.org/wiki/Subroutine)，亦称为function、routine、method或subprogram，是构建程序的基本单位。


